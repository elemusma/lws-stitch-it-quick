"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var r=t,o=[],n=!0,t=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(o.push(s.value),!r||o.length!==r);n=!0);}catch(e){t=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(t)throw i}}return o}throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}}(),_get=function e(t,r,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);return void 0!==n?"value"in n?n.value:void 0!==(n=n.get)?n.call(o):void 0:null!==(n=Object.getPrototypeOf(t))?e(n,r,o):void 0};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}jQuery(function(d){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.debug=e.debug,t.styles=e.styles,t.publicToken=e.publicToken,t.locale=e.locale,d("form#order_review").length?t.handle_pay_page():d("form#add_payment_method").length&&t.handle_add_payment_method_page(),t}return window.WC_First_Data_Clover_Payment_Form_Handler=(_inherits(r,SV_WC_Payment_Form_Handler_v5_11_12),_createClass(r,[{key:"handle_checkout_page",value:function(){var e=this;_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"handle_checkout_page",this).call(this),d(document.body).on("checkout_error",function(){e.set_token(),e.unblock_ui()})}},{key:"handle_pay_page",value:function(){this.publicToken&&_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"handle_pay_page",this).call(this)}},{key:"handle_add_payment_method_page",value:function(){this.publicToken&&_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"handle_add_payment_method_page",this).call(this)}},{key:"set_payment_fields",value:function(){var t=this,e="#wc-"+this.id_dasherized+"-account-number-hosted",r="#wc-"+this.id_dasherized+"-expiry-hosted",o="#wc-"+this.id_dasherized+"-csc-hosted",n="#wc-"+this.id_dasherized+"-street-address-hosted",i="#wc-"+this.id_dasherized+"-postal-code-hosted";0===d(e+" iframe").length&&0!==d(e).length&&(this.integration=new Clover(this.publicToken,{locale:this.locale}),this.elements=this.integration.elements(),this.hostedElements={cardNumber:this.elements.create("CARD_NUMBER",this.styles),expiry:this.elements.create("CARD_DATE",this.styles),cvv:this.elements.create("CARD_CVV",this.styles),postalCode:this.elements.create("CARD_POSTAL_CODE",this.styles)},this.hostedElements.cardNumber.mount(e),this.hostedElements.expiry.mount(r),this.hostedElements.cvv.mount(o),this.hostedElements.postalCode.mount(i),0!==d(n).length&&(this.hostedElements.streetAddress=this.elements.create("CARD_STREET_ADDRESS",this.styles),this.hostedElements.streetAddress.mount(n)),Object.values(this.hostedElements).forEach(function(e){e.addEventListener("change",function(e){return t.on_field_change(e)}),e.addEventListener("blur",function(e){return t.on_field_change(e)})}))}},{key:"on_field_change",value:function(e){var t={CARD_NUMBER:"#wc-"+this.id_dasherized+"-account-number-hosted-error",CARD_DATE:"#wc-"+this.id_dasherized+"-expiry-hosted-error",CARD_CVV:"#wc-"+this.id_dasherized+"-csc-hosted-error",CARD_STREET_ADDRESS:"#wc-"+this.id_dasherized+"-street-address-hosted-error",CARD_POSTAL_CODE:"#wc-"+this.id_dasherized+"-postal-code-hosted-error"},r=!0,o=!1,n=void 0;try{for(var i,s=Object.entries(t)[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var a=_slicedToArray(i.value,2),l=a[0],c=a[1];void 0!==e[l]&&void 0!==e[l].error&&d(c).text(e[l].error),void 0!==e[l]&&void 0===e[l].error&&e[l].touched&&d(c).text("")}}catch(e){o=!0,n=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw n}}}},{key:"validate_payment_data",value:function(){return!(this.is_selected()&&!this.has_token()&&!this.using_saved_card()&&(this.block_ui(),this.create_token(),1))}},{key:"format_credit_card_inputs",value:function(){}},{key:"create_token",value:function(){var t=this;this.integration.createToken().then(function(e){if(void 0!==e.token)return t.log("token created",e),t.set_token(e),t.form.submit();t.handle_token_error(e)}).catch(function(e){t.handle_token_error(e)})}},{key:"handle_token_error",value:function(e){var t="";return e.errors?Object.values(e.errors).forEach(function(e){t+=e+"<br />"}):t=JSON.stringify(e),this.log("token error",e),this.unblock_ui(),this.set_token(),d(".woocommerce-error, .woocommerce-message").remove(),this.form.prepend('<p class="woocommerce-error">'+t+"</p>"),this.form.removeClass("processing").unblock(),this.form.find(".input-text, select").blur(),d("html, body").animate({scrollTop:this.form.offset().top-100},1e3)}},{key:"set_token",value:function(e){var t=null!=(e=null==e?{card:{}}:e).token?e.token:"",r=null!=e.card.exp_month?e.card.exp_month:"",o=null!=e.card.exp_year?e.card.exp_year:"",e=null!=e.card.last4&&null!=e.card.first6?e.card.first6+e.card.last4:"";d("input[name=wc-"+this.id_dasherized+"-js-token]").val(t),d("input[name=wc-"+this.id_dasherized+"-account-number]").val(e),d("input[name=wc-"+this.id_dasherized+"-exp-month]").val(r),d("input[name=wc-"+this.id_dasherized+"-exp-year]").val(o)}},{key:"has_token",value:function(){return d("input[name=wc-"+this.id_dasherized+"-js-token]").val()}},{key:"using_saved_card",value:function(){return this.form.find("input.js-wc-"+this.id_dasherized+"-payment-token:checked").val()}},{key:"is_selected",value:function(){return this.get_selected_gateway_id()===this.id}},{key:"get_selected_gateway_id",value:function(){return this.form.find("input[name=payment_method]:checked").val()}},{key:"log",value:function(e,t){this.debug&&(console.log("[Clover] "+e),console.log(t))}}]),r),d(document.body).trigger("wc_first_data_clover_payment_form_handler_loaded")});