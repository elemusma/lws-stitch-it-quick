"use strict";var _createClass=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}(),_get=function e(t,n,o){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);return void 0!==r?"value"in r?r.value:void 0!==(r=r.get)?r.call(o):void 0:null!==(r=Object.getPrototypeOf(t))?e(r,n,o):void 0};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}jQuery(function(a){function o(e){_classCallCheck(this,o);var n=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return n.paymentFormInstance=null,n.errors=[],a(document.body).on("sv_wc_payment_form_valid_payment_data",function(e,t){if(t.payment_form.id===n.id){if(!n.saved_payment_method_selected)return n.getClientToken()?(console.log("Client token found: submitting form for processing..."),!0):null!==n.paymentFormInstance?(n.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),n.paymentFormInstance.onSubmit(function(e){console.log("Payment.JS success"),a('input[name="wc-first-data-payeezy-credit-card-client-token"]').val(e),t.payment_form.form.submit()},function(e){console.log("Payment.JS error: "+e),t.payment_form.render_errors([window.wc_first_data_payeezy_payment_js_payment_form.i18n.form_validation_error])}),!1):(console.error("Payment form instance is missing"),void t.payment_form.render_errors([window.wc_first_data_payeezy_payment_js_payment_form.i18n.general_error]));console.log("Using an existing payment method...")}}),n}window.WC_First_Data_Payeezy_Payment_JS_Form_Handler=(_inherits(o,SV_WC_Payment_Form_Handler_v5_12_4),_createClass(o,[{key:"set_payment_fields",value:function(){var t=this,e=(_get(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"set_payment_fields",this).call(this),this.form.find("input[name=payment_method]:checked").val()===this.id&&this.block_ui(),{preFlowHook:function(e){t.authorizeSession(e)}}),n=window.wc_first_data_payeezy_payment_js_payment_form.payment_js_configuration;try{if(null===n||!window.firstdata)throw new Error("SDK is not loaded.");window.firstdata.createPaymentForm(n,e,function(e){console.log("Payment.JS initialized"),t.paymentFormInstance=e})}catch(e){console.error("Failed initializing Payment.JS. "+e.message),this.render_inline_error(window.wc_first_data_payeezy_payment_js_payment_form.i18n.general_error)}finally{this.unblock_ui()}}},{key:"authorizeSession",value:function(o){var r=this,e=(console.log("Payment.JS session authorization..."),window.wc_first_data_payeezy_payment_js_payment_form.ajax_url||""),t=window.wc_first_data_payeezy_payment_js_payment_form.generate_payment_js_client_token_nonce||"",n=0<a("form#order_review").data("order-id")?a("form#order_review").data("order-id"):window.wc_first_data_payeezy_payment_js_payment_form.order_id||"";a.post(e,{action:"wc_first_data_payeezy_payment_js_generate_client_token",security:t,order:n?parseInt(n,10):0}).done(function(e){var t,n;e.success&&e.data?(console.log("Payment.JS session authorization success"),t=e.data.clientToken,n=e.data.publicKeyBase64,o({clientToken:t,publicKeyBase64:n})):(console.log("Payment.JS session authorization error"),console.log(e.data||e),r.render_errors([window.wc_first_data_payeezy_payment_js_payment_form.i18n.authorization_error]))})}},{key:"getClientToken",value:function(){return a('input[name="wc-first-data-payeezy-credit-card-client-token"]').val()}},{key:"validate_card_data",value:function(){return!0}},{key:"render_inline_error",value:function(e){var t=a("div.js-wc-"+this.id_dasherized+"-new-payment-method-form");t.prepend('<div class="woocommerce-error">'+e+"</div>"),t.find(".form-row").hide()}}]),o),a(document.body).trigger("wc_first_data_payeezy_payment_js_form_handler_loaded")});