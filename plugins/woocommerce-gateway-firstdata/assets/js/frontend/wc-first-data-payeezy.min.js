"use strict";var _createClass=function(){function r(a,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}}return function(a,e,t){return e&&r(a.prototype,e),t&&r(a,t),a}}();function _classCallCheck(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}!function(){jQuery(function(i){function a(){var t=this;_classCallCheck(this,a),this.params=window.wc_first_data_payeezy_params,i(document.body).on("sv_wc_payment_form_valid_payment_data",function(a,e){return t.init(a,e)}),i(document.body).on("updated_checkout",function(){return t.handle_saved_payment_methods()})}return window.WC_First_Data_Payeezy_Credit_Card_Tokenization_Handler=(_createClass(a,[{key:"init",value:function(a,e){if(this.payment_form=e.payment_form,"first_data_payeezy_credit_card"===this.payment_form.id&&!this.payment_form.saved_payment_method_selected&&e.passed_validation)return!!this.has_token()||(this.tokenize_card(),!1)}},{key:"tokenize_card",value:function(){var a,e=this;return this.payment_form.block_ui(),a=this.get_request_data(),this.log_data(a,"request"),i.ajax({url:this.params.api_url,dataType:"jsonp",data:a,success:function(a){return e.handle_response(a)}})}},{key:"get_request_data",value:function(){var a,e,t=i.payment.cardType(i("input[id=wc-first-data-payeezy-credit-card-account-number]").val());return"dinersclub"===(t="amex"===t?"American Express":t)&&(t="Diners Club"),1===(a=(e=i("input[name=wc-first-data-payeezy-credit-card-expiry]").val()).slice(0,e.indexOf(" "))).length&&(a="0"+a),e=e.slice(-2),{apikey:this.params.api_key,js_security_key:this.params.js_security_key,ta_token:this.params.transarmor_token,auth:this.params.pre_auth?"true":"false",type:"FDToken","credit_card.type":t,"credit_card.cardholder_name":i("input[name=billing_first_name]").val()+" "+i("input[name=billing_last_name]").val(),"credit_card.card_number":i("input[id=wc-first-data-payeezy-credit-card-account-number]").val(),"credit_card.exp_date":a+e,"credit_card.cvv":i("input[id=wc-first-data-payeezy-credit-card-csc]").val(),"billing_address.street":i("input[name=billing_address_1]").val(),"billing_address.city":i("#billing_city").val(),"billing_address.state_province":i("#billing_state").val(),"billing_address.zip_postal_code":i("input[name=billing_postcode]").val(),"billing_address.country":i("#billing_country").val()}}},{key:"handle_response",value:function(a){return this.log_data(a,"response"),null!=a.status&&201===a.status?(this.set_token(a.results.token.value),this.payment_form.form.submit()):(console.log(a),this.payment_form.render_errors([a.results.Error.messages[0].description]),this.payment_form.unblock_ui())}},{key:"set_token",value:function(a){return i("input[name=wc-first-data-payeezy-credit-card-token]").val(a),a=i("input[id=wc-first-data-payeezy-credit-card-account-number]").val().slice(-4),i("input[name=wc-first-data-payeezy-credit-card-last-four]").val(a),a=i.payment.cardType(i("input[id=wc-first-data-payeezy-credit-card-account-number]").val()),i("input[name=wc-first-data-payeezy-credit-card-card-type]").val(a)}},{key:"has_token",value:function(){return i("input[name=wc-first-data-payeezy-credit-card-token]").val()}},{key:"handle_saved_payment_methods",value:function(){var e="js-sv-wc-payment-gateway-credit-card-form-csc";return i("input.js-wc-first-data-payeezy-credit-card-payment-token").change(function(){var a=i("#wc-first-data-payeezy-credit-card-credit-card-form");return i("input.js-wc-first-data-payeezy-credit-card-payment-token:checked").val()?(a.hide(),i("#wc-first-data-payeezy-credit-card-csc").removeClass(e)):(i("#wc-first-data-payeezy-credit-card-csc").addClass(e),a.show())})}},{key:"log_data",value:function(a,e){var t,r;if(this.params.ajax_log){for(t in r={},a)r[t]=a[t];return"credit_card.card_number"in r&&(r["credit_card.card_number"]=r["credit_card.card_number"].replace(/\d(?=\d{4})/g,"*")),"credit_card.cvv"in r&&r["credit_card.cvv"]&&(r["credit_card.cvv"]=r["credit_card.cvv"].replace(/[0-9]/g,"*")),e={action:"wc_"+this.payment_form.id+"_log_js_data",security:this.params.ajax_log_nonce,type:e,data:r},i.ajax({url:this.params.ajax_url,data:e})}}}]),a),window.wc_first_data_payeezy_credit_card_tokenization_handler=new WC_First_Data_Payeezy_Credit_Card_Tokenization_Handler})}.call(void 0);